{"version":3,"file":"findMintWithMetadataByAddress.mjs","sources":["../../../../src/plugins/nftModule/findMintWithMetadataByAddress.ts"],"sourcesContent":["import type { Commitment, PublicKey } from '@solana/web3.js';\nimport { Metaplex } from '@/Metaplex';\nimport { Operation, useOperation, OperationHandler } from '@/types';\nimport { toMetadata, toMintWithMetadata, MintWithMetadata } from './Metadata';\nimport { toMint, Mint, toMintAccount } from '../tokenModule';\nimport { findMetadataPda, parseMetadataAccount } from '@/programs';\nimport { DisposableScope } from '@/utils';\n\n// -----------------\n// Operation\n// -----------------\n\nconst Key = 'FindMintWithMetadataByAddressOperation' as const;\nexport const findMintWithMetadataByAddressOperation =\n  useOperation<FindMintWithMetadataByAddressOperation>(Key);\nexport type FindMintWithMetadataByAddressOperation = Operation<\n  typeof Key,\n  FindMintWithMetadataByAddressInput,\n  MintWithMetadata | Mint\n>;\n\nexport type FindMintWithMetadataByAddressInput = {\n  address: PublicKey;\n  commitment?: Commitment;\n  loadJsonMetadata?: boolean; // Default: true\n};\n\n// -----------------\n// Handler\n// -----------------\n\nexport const findMintWithMetadataByAddressOperationHandler: OperationHandler<FindMintWithMetadataByAddressOperation> =\n  {\n    handle: async (\n      operation: FindMintWithMetadataByAddressOperation,\n      metaplex: Metaplex,\n      scope: DisposableScope\n    ): Promise<MintWithMetadata | Mint> => {\n      const {\n        address: mintAddress,\n        commitment,\n        loadJsonMetadata = true,\n      } = operation.input;\n      const metadataAddress = findMetadataPda(mintAddress);\n\n      const accounts = await metaplex\n        .rpc()\n        .getMultipleAccounts([mintAddress, metadataAddress], commitment);\n\n      const mintAccount = toMintAccount(accounts[0]);\n\n      if (!accounts[1].exists) {\n        return toMint(mintAccount);\n      }\n\n      const metadataAccount = parseMetadataAccount(accounts[1]);\n      let metadataModel = toMetadata(metadataAccount);\n      if (loadJsonMetadata) {\n        metadataModel = await metaplex\n          .nfts()\n          .loadJsonMetadata(metadataModel)\n          .run(scope);\n      }\n\n      return toMintWithMetadata(mintAccount, metadataModel);\n    },\n  };\n"],"names":["Key","findMintWithMetadataByAddressOperation","useOperation","findMintWithMetadataByAddressOperationHandler","handle","operation","metaplex","scope","address","mintAddress","commitment","loadJsonMetadata","input","metadataAddress","findMetadataPda","accounts","rpc","getMultipleAccounts","mintAccount","toMintAccount","exists","toMint","metadataAccount","parseMetadataAccount","metadataModel","toMetadata","nfts","run","toMintWithMetadata"],"mappings":";;;;;;;AAQA;AACA;AACA;AAEA,MAAMA,GAAG,GAAG,wCAAZ,CAAA;MACaC,sCAAsC,GACjDC,YAAY,CAAyCF,GAAzC,EADP;AAcP;AACA;AACA;AAEO,MAAMG,6CAAuG,GAClH;AACEC,EAAAA,MAAM,EAAE,OACNC,SADM,EAENC,QAFM,EAGNC,KAHM,KAI+B;IACrC,MAAM;AACJC,MAAAA,OAAO,EAAEC,WADL;MAEJC,UAFI;AAGJC,MAAAA,gBAAgB,GAAG,IAAA;KACjBN,GAAAA,SAAS,CAACO,KAJd,CAAA;AAKA,IAAA,MAAMC,eAAe,GAAGC,eAAe,CAACL,WAAD,CAAvC,CAAA;AAEA,IAAA,MAAMM,QAAQ,GAAG,MAAMT,QAAQ,CAC5BU,GADoB,EAEpBC,CAAAA,mBAFoB,CAEA,CAACR,WAAD,EAAcI,eAAd,CAFA,EAEgCH,UAFhC,CAAvB,CAAA;IAIA,MAAMQ,WAAW,GAAGC,aAAa,CAACJ,QAAQ,CAAC,CAAD,CAAT,CAAjC,CAAA;;AAEA,IAAA,IAAI,CAACA,QAAQ,CAAC,CAAD,CAAR,CAAYK,MAAjB,EAAyB;MACvB,OAAOC,MAAM,CAACH,WAAD,CAAb,CAAA;AACD,KAAA;;IAED,MAAMI,eAAe,GAAGC,oBAAoB,CAACR,QAAQ,CAAC,CAAD,CAAT,CAA5C,CAAA;AACA,IAAA,IAAIS,aAAa,GAAGC,UAAU,CAACH,eAAD,CAA9B,CAAA;;AACA,IAAA,IAAIX,gBAAJ,EAAsB;AACpBa,MAAAA,aAAa,GAAG,MAAMlB,QAAQ,CAC3BoB,IADmB,EAAA,CAEnBf,gBAFmB,CAEFa,aAFE,CAAA,CAGnBG,GAHmB,CAGfpB,KAHe,CAAtB,CAAA;AAID,KAAA;;AAED,IAAA,OAAOqB,kBAAkB,CAACV,WAAD,EAAcM,aAAd,CAAzB,CAAA;AACD,GAAA;AAjCH;;;;"}